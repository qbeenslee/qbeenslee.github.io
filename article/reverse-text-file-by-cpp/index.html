<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>C&#43;&#43;写的文本颠倒代码 | Hey sister</title><meta name="description" content="（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）"><meta name="keywords" content="cpp,algorithm,文本处理"><meta name="author" content="qbeenslee"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#ffffff"><meta property="og:title" content="C&#43;&#43;写的文本颠倒代码 | Hey sister"><meta property="og:description" content="（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）"><meta property="og:url" content="https://qbeenslee.com/article/reverse-text-file-by-cpp/"><meta property="og:site_name" content="Hey sister"><meta property="og:type" content="article"><meta property="article:section" content="Article"><meta property="article:tag" content="cpp"><meta property="article:tag" content="algorithm"><meta property="article:tag" content="文本处理"><meta property="article:published_time" content="2013-09-23T01:02:46&#43;08:00"><meta property="article:modified_time" content="2013-09-23T01:02:46&#43;08:00"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><link rel="alternate" type="application/rss+xml" title="Hey sister" href="https://qbeenslee.com/index.xml"><link rel="stylesheet" href="https://qbeenslee.com/css/main-13f86007da.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery_lazyload/1.9.7/jquery.lazyload.min.js" type="text/javascript"></script></head><body style="background-color:#fff"><header id="header" class="auto_header unselectable opaqueHeader" style="top:0;position:fixed;z-index:1100"><div class="homepage"><a href="/"><div class="title">Hey sister</div></a></div><div id="nav-bar"><nav class="nav-item"> <a class="nav-color-normal" href="/bb/">小声BB</a></nav><nav class="nav-item dropdown"> <a class="dropbtn nav-color-normal">归档<span class="caret"></span></a><div class="dropdown-content"> <a href="/tags/">标签</a><a href="/categories/">类目</a></div></nav><nav class="nav-item dropdown"> <a class="dropbtn nav-color-normal">关于<span class="caret"></span></a><div class="dropdown-content"> <a href="/about/me/">关于我</a><a href="/friends/">友情链接</a><a href="/about/website/">技术说明</a><a href="/copyright/">版权声明</a><a href="/index.xml">订阅</a></div></nav></div><div class="nav-plugins"><div class="nav-plugin"><div class="search-button nav-color-normal"><svg onclick="toggleSearch()" width="18px" height="18px" viewBox="0 0 512.005 512.005" xmlns="http://www.w3.org/2000/svg"><path d="m505.749 475.587-145.6-145.6c28.203-34.837 45.184-79.104 45.184-127.317 0-111.744-90.923-202.667-202.667-202.667s-202.666 90.922-202.666 202.666 90.923 202.667 202.667 202.667c48.213 0 92.48-16.981 127.317-45.184l145.6 145.6c4.16 4.16 9.621 6.251 15.083 6.251s10.923-2.091 15.083-6.251c8.341-8.341 8.341-21.824-.001-30.165zm-303.082-112.918c-88.235 0-160-71.765-160-160s71.765-160 160-160 160 71.765 160 160-71.766 160-160 160z"/></svg></div></div><div class="search-box"><div class="search"><div class="input"><input class="prompt" maxlength="1000" autocomplete="off" type="text" placeholder="搜索"></div><div class="results"></div></div></div></div></header><main style="background-color:#fff"><div id="page" class="page horizontal-safe vertical-safe"><div class="page-wrap"><div class="middle-side"><article><div class="article-header"><h1 class="title">C&#43;&#43;写的文本颠倒代码</h1><span class="subtitle">2013年9月23日 01:02</span></div><div class="content" id="content"><blockquote><p>（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）</p></blockquote><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#60a0b0;font-style:italic">/* C++ */</span>
<span style="color:#007020">#include</span> <span style="color:#007020">&lt;iostream&gt;</span><span style="color:#007020">
</span><span style="color:#007020">#include</span> <span style="color:#007020">&lt;fstream&gt;</span><span style="color:#007020">
</span><span style="color:#007020">#include</span> <span style="color:#007020">&lt;ctime&gt;</span><span style="color:#007020">
</span><span style="color:#007020"></span><span style="color:#902000">int</span> <span style="color:#06287e">main</span>()
{
	clock_t start, finish;
	start <span style="color:#666">=</span> clock();
	<span style="color:#902000">long</span>		len <span style="color:#666">=</span> <span style="color:#666">-</span><span style="color:#40a070">1L</span>;                                                      <span style="color:#60a0b0;font-style:italic">/* 与文件头的距离 */</span>
	<span style="color:#902000">char</span>		tmp, last;                                                      <span style="color:#60a0b0;font-style:italic">/* tmp记录当刻值,last记录上一个值 */</span>
	<span style="color:#902000">bool</span>		tag <span style="color:#666">=</span> <span style="color:#007020">false</span>, flag <span style="color:#666">=</span> <span style="color:#007020">false</span>;                                      <span style="color:#60a0b0;font-style:italic">/* tag用于标记第二个&#39;\n&#39;,flag用于标记汉字 */</span>
	std<span style="color:#666">::</span>ifstream	inp( <span style="color:#4070a0">&#34;in.txt&#34;</span>, std<span style="color:#666">::</span>ios<span style="color:#666">::</span>in );
	std<span style="color:#666">::</span>ofstream	oup( <span style="color:#4070a0">&#34;out.txt&#34;</span>, std<span style="color:#666">::</span>ios<span style="color:#666">::</span>out );
	<span style="color:#007020;font-weight:700">if</span> ( inp.fail() <span style="color:#666">==</span> <span style="color:#007020">true</span> )
	{
		std<span style="color:#666">::</span>cout <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;please make sure the file is exist !&#34;</span> <span style="color:#666">&lt;&lt;</span> std<span style="color:#666">::</span>endl; exit( <span style="color:#40a070">1</span> );
	}
	inp.seekg( len, inp.end );                                                      <span style="color:#60a0b0;font-style:italic">/* 移至文件尾 */</span>
	len <span style="color:#666">=</span> (<span style="color:#902000">long</span>) inp.tellg();                                                       <span style="color:#60a0b0;font-style:italic">/* 获取文件尾距离头的距离 */</span>
	std<span style="color:#666">::</span>cerr <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;A total of &#34;</span> <span style="color:#666">&lt;&lt;</span> len <span style="color:#666">+</span> <span style="color:#40a070">1</span> <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34; bytes</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">Opening file ...&#34;</span>;            <span style="color:#60a0b0;font-style:italic">/* 显示文件大小 */</span>
	<span style="color:#007020;font-weight:700">while</span> ( len <span style="color:#666">&gt;=</span> <span style="color:#40a070">0</span> )
	{
		inp.seekg( len<span style="color:#666">--</span>, inp.beg );                                            <span style="color:#60a0b0;font-style:italic">/* 测试结果是:从文件头开始寻址,比从当前位置ios::cur寻址快一点. */</span>
		tmp <span style="color:#666">=</span> inp.get();
		<span style="color:#007020;font-weight:700">if</span> ( tmp <span style="color:#666">==</span> <span style="color:#40a070">10</span> <span style="color:#666">&amp;&amp;</span> <span style="color:#666">!</span>(tag <span style="color:#666">^=</span> <span style="color:#40a070">1</span>) )
			<span style="color:#007020;font-weight:700">continue</span>;                                                       <span style="color:#60a0b0;font-style:italic">/* windows中‘\t’和‘\r’重复 if(flag) */</span>
		{
			oup <span style="color:#666">&lt;&lt;</span> tmp <span style="color:#666">&lt;&lt;</span> last;                                             <span style="color:#60a0b0;font-style:italic">/* 汉字输出 */</span>
			flag <span style="color:#666">=</span> <span style="color:#007020">false</span>;
		} <span style="color:#007020;font-weight:700">else</span> <span style="color:#007020;font-weight:700">if</span> ( tmp <span style="color:#666">&lt;</span> <span style="color:#40a070">0</span> )
		{
			last	<span style="color:#666">=</span> tmp;
			flag	<span style="color:#666">=</span> <span style="color:#007020">true</span>;
		} <span style="color:#007020;font-weight:700">else</span>
			oup <span style="color:#666">&lt;&lt;</span> tmp;                                                     <span style="color:#60a0b0;font-style:italic">/* ASCII表内值输出 */</span>
	}
	inp.close();
	oup.close();
	finish <span style="color:#666">=</span> clock();
	system( <span style="color:#4070a0">&#34;out.txt&#34;</span> );                                                            <span style="color:#60a0b0;font-style:italic">/* 打开输出文件 */</span>
	std<span style="color:#666">::</span>cerr <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">Open the file successfully</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">&#34;</span>;
	oup.open( <span style="color:#4070a0">&#34;run_time.txt&#34;</span>, std<span style="color:#666">::</span>ios<span style="color:#666">::</span>app );
	oup <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;Time: &#34;</span> <span style="color:#666">&lt;&lt;</span> (finish <span style="color:#666">-</span> start) <span style="color:#666">/</span> <span style="color:#40a070">1000.0</span> <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34; (s)-use beg&#34;</span> <span style="color:#666">&lt;&lt;</span> std<span style="color:#666">::</span>endl;    <span style="color:#60a0b0;font-style:italic">/* 在文件中写入操作时间 */</span>
	<span style="color:#007020;font-weight:700">return</span>(<span style="color:#40a070">0</span>);
}
</code></pre></div><blockquote><p>注：</p><p>代码中使用从文件头开始寻址，比从当前位置ios::cur寻址快一点的原因是由于磁盘的读写方式决定的。因为，所有的寻址搜索都是文件头开始的，cur寻址先从文件头进行寻址到cur位置<br> 再从cur寻址到偏移地址，beg从文件头通过偏移地址得到地址，所以beg要快。</p></blockquote><p>//为了验证这种读写方式，请看我写的一个简单的测试过程：</p><p>为了使影响检测的因素简单化，我把上面代码中一些无关部分删除。</p><p>测试代码：</p><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#007020">#include</span> <span style="color:#007020">&lt;iostream&gt;</span><span style="color:#007020">
</span><span style="color:#007020">#include</span> <span style="color:#007020">&lt;fstream&gt;</span><span style="color:#007020">
</span><span style="color:#007020">#include</span> <span style="color:#007020">&lt;ctime&gt;</span><span style="color:#007020">
</span><span style="color:#007020"></span><span style="color:#902000">int</span> <span style="color:#06287e">main</span>()
{
	clock_t start, finish;
	start <span style="color:#666">=</span> clock();
	<span style="color:#902000">long</span>		len <span style="color:#666">=</span> <span style="color:#666">-</span><span style="color:#40a070">1L</span>;
	std<span style="color:#666">::</span>ifstream	inp( <span style="color:#4070a0">&#34;in.txt&#34;</span>, std<span style="color:#666">::</span>ios<span style="color:#666">::</span>in );
	std<span style="color:#666">::</span>ofstream	oup( <span style="color:#4070a0">&#34;out.txt&#34;</span>, std<span style="color:#666">::</span>ios<span style="color:#666">::</span>out );
	inp.seekg( len, inp.end );
	len <span style="color:#666">=</span> (<span style="color:#902000">long</span>) inp.tellg();
	std<span style="color:#666">::</span>cerr <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;A total of &#34;</span> <span style="color:#666">&lt;&lt;</span> len <span style="color:#666">+</span> <span style="color:#40a070">1</span> <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34; bytes</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">Opening file ...&#34;</span>;
	<span style="color:#007020;font-weight:700">while</span> ( len <span style="color:#666">&gt;=</span> <span style="color:#40a070">0</span> )
	{
		<span style="color:#60a0b0;font-style:italic">/******使用ios::cur寻址的代码********/</span>
		oup <span style="color:#666">&lt;&lt;</span> (<span style="color:#902000">char</span>) inp.get();
		inp.seekg( <span style="color:#666">-</span><span style="color:#40a070">2L</span>, inp.cur ); len<span style="color:#666">--</span>;


<span style="color:#60a0b0;font-style:italic">/*******使用ios::beg寻址的代码********
</span><span style="color:#60a0b0;font-style:italic"> * inp.seekg(len--,inp.beg);
</span><span style="color:#60a0b0;font-style:italic"> * oup&lt;&lt;(char)inp.get();
</span><span style="color:#60a0b0;font-style:italic"> ************************************/</span>
	}
	inp.close();
	oup.close();
	finish <span style="color:#666">=</span> clock();
	FILE<span style="color:#666">*</span>p1 <span style="color:#666">=</span> fopen( <span style="color:#4070a0">&#34;run_time.txt&#34;</span>, <span style="color:#4070a0">&#34;a+&#34;</span> );
	fprintf( p1, <span style="color:#4070a0">&#34;Time: %.3lf (s)-use cur</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">&#34;</span>, (<span style="color:#902000">double</span>) (finish <span style="color:#666">-</span> start) <span style="color:#666">/</span> <span style="color:#40a070">1000.0</span> ); <span style="color:#60a0b0;font-style:italic">/* 牵扯格式的我比较喜欢用C */</span>
	fclose( p1 );
	system( <span style="color:#4070a0">&#34;run_time.txt&#34;</span> );
	std<span style="color:#666">::</span>cerr <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">&#34;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">Open the file successfully</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">&#34;</span>;
	<span style="color:#007020;font-weight:700">return</span>(<span style="color:#40a070">0</span>);
}
</code></pre></div><p>然后，使用一个1000000字节的文本文件测试（测试数据生成代码在最后面），测试结果如下：<br></p><figure class="image-dialog"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-original="https://i.imgur.com/fOGzLOv.jpg" alt="测试结果"><figcaption>测试结果</figcaption></figure><p></p><p>前三个是使用ios::beg寻址的，后三个是使用ios::cur寻址的，很明显前者要快一点。所以印证了我前面所说的。</p><p>附测试数据生成代码：</p><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#007020">#include</span> <span style="color:#007020">&lt;iostream&gt;</span><span style="color:#007020">
</span><span style="color:#007020">#include</span> <span style="color:#007020">&lt;cstdlib&gt;</span><span style="color:#007020">
</span><span style="color:#007020"></span><span style="color:#007020;font-weight:700">using</span> <span style="color:#007020;font-weight:700">namespace</span> std;
<span style="color:#902000">int</span> <span style="color:#06287e">main</span>()
{
	freopen( <span style="color:#4070a0">&#34;out.txt&#34;</span>, <span style="color:#4070a0">&#34;w&#34;</span>, stdout );
	<span style="color:#902000">long</span> n <span style="color:#666">=</span> <span style="color:#40a070">1000000</span>;
	<span style="color:#007020;font-weight:700">while</span> ( n<span style="color:#666">--</span> )
	{
		putchar( <span style="color:#40a070">65</span> <span style="color:#666">+</span> rand() <span style="color:#666">%</span> <span style="color:#40a070">26</span> ); <span style="color:#60a0b0;font-style:italic">/* 大写字母 */</span>
	}
	<span style="color:#007020;font-weight:700">return</span>(<span style="color:#40a070">0</span>);
}
</code></pre></div><p>测试环境皆为Win XP professional，VC++6.0</p></div></article></div></div><div class="comment-wrap unselectable"><style>#vcomments .info,.at,.vcontent>a[href^="#"],.vcopy,.vlink,.vmail,.vpower,.vsys{display:none!important}.v .vlist .vcard{padding-top:0!important}.v code,.v pre{font-size:100%!important}.vinput{border:none!important}.vheader{border-bottom:1px dashed #dedede}</style><section class="section-content unselectable"><div id="vcomments" class="container"></div></section><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",lang:"zh-cn",appId:"G3MMP8E4DNTqvCPV48o7Ph23-gzGzoHsz",appKey:"jYCgILtFpGK1vJUJSE5TtIIs",notify:!1,verify:!1,avatar:"hide",visitor:!1,recordIP:!0,placeholder:"随便说点啥~~"})</script></div></div></main><footer class="site_footer_grap unselectable"><div class="has-text-centered"><p>&copy;Qbeenslee 2021</p></div></footer><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css"><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script type="text/javascript" src="https://qbeenslee.com/js/main-0516e36519.js"></script><script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script><script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script><script type="text/javascript">var imgs=$("img");imgs.on("contextmenu",function(){return!1}),imgs.on("dragstart",function(){return!1})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?58b3c65a09f5aacd0e62efe29897c7e4";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>