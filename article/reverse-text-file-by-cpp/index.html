<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>C&#43;&#43;写的文本颠倒代码 | Hey sister</title><meta name="description" content="（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）"><meta name="keywords" content="cpp,algorithm,文本处理"><meta name="author" content="qbeenslee"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><meta property="og:title" content="C&#43;&#43;写的文本颠倒代码 | Hey sister"><meta property="og:description" content="（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）"><meta property="og:url" content="https://qbeenslee.com/article/reverse-text-file-by-cpp/"><meta property="og:site_name" content="Hey sister"><meta property="og:type" content="article"><meta property="article:section" content="Article"><meta property="article:tag" content="cpp"><meta property="article:tag" content="algorithm"><meta property="article:tag" content="文本处理"><meta property="article:published_time" content="2013-09-23T01:02:46&#43;08:00"><meta property="article:modified_time" content="2013-09-23T01:02:46&#43;08:00"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><link rel="alternate" type="application/rss+xml" title="Hey sister" href="https://qbeenslee.com/index.xml"><link rel="stylesheet" href="https://qbeenslee.com/css/main.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js" type="text/javascript"></script></head><body><link rel="stylesheet" href="https://qbeenslee.com/lib/photoswipe/photoswipe.min.css"><link rel="stylesheet" href="https://qbeenslee.com/lib/photoswipe/default-skin/default-skin.min.css"><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><header id="header" class="auto_header unselectable opaqueHeader" style="top:0;position:fixed;z-index:9999"><div class="site"><a href="/"><div class="title">Hey sister</div></a></div><div id="nav-bar"><nav class="nav-item"> <a class="nav-color-normal" href="/gallery/">相册</a></nav><nav class="nav-item"> <a class="nav-color-normal" href="/bb/">小声BB</a></nav><nav class="nav-item dropdown"> <a class="dropbtn nav-color-normal">关于<span class="caret"></span></a><div class="dropdown-content"> <a href="/about/">关于我</a> <a href="/about/friends/">友情链接</a> <a href="/copyright/">版权声明</a></div></nav></div></header><main style="background-color:#fff"><div id="page" class="vertical-safe"><div class="page-wrap"><div class="middle-side horizontal-safe"><article><div class="article-header"><h1 class="title">C&#43;&#43;写的文本颠倒代码</h1><span class="subtitle">2013年9月23日 01:02</span></div><div class="content"><blockquote><p>（过程：从名为“in.txt”中读取信息，颠倒输出到“out.txt”中。）</p></blockquote><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cm">/* C++ */</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">clock_t</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">;</span>
	<span class="n">start</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
	<span class="kt">long</span>		<span class="n">len</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span><span class="p">;</span>                                                      <span class="cm">/* 与文件头的距离 */</span>
	<span class="kt">char</span>		<span class="n">tmp</span><span class="p">,</span> <span class="n">last</span><span class="p">;</span>                                                      <span class="cm">/* tmp记录当刻值,last记录上一个值 */</span>
	<span class="kt">bool</span>		<span class="n">tag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>                                      <span class="cm">/* tag用于标记第二个&#39;\n&#39;,flag用于标记汉字 */</span>
	<span class="n">std</span><span class="o">::</span><span class="n">ifstream</span>	<span class="n">inp</span><span class="p">(</span> <span class="s">&#34;in.txt&#34;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">ofstream</span>	<span class="n">oup</span><span class="p">(</span> <span class="s">&#34;out.txt&#34;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="n">inp</span><span class="p">.</span><span class="n">fail</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;please make sure the file is exist !&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>
	<span class="p">}</span>
	<span class="n">inp</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span> <span class="n">len</span><span class="p">,</span> <span class="n">inp</span><span class="p">.</span><span class="n">end</span> <span class="p">);</span>                                                      <span class="cm">/* 移至文件尾 */</span>
	<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">inp</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>                                                       <span class="cm">/* 获取文件尾距离头的距离 */</span>
	<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A total of &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; bytes</span><span class="se">\n</span><span class="s">Opening file ...&#34;</span><span class="p">;</span>            <span class="cm">/* 显示文件大小 */</span>
	<span class="k">while</span> <span class="p">(</span> <span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">inp</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span> <span class="n">len</span><span class="o">--</span><span class="p">,</span> <span class="n">inp</span><span class="p">.</span><span class="n">beg</span> <span class="p">);</span>                                            <span class="cm">/* 测试结果是:从文件头开始寻址,比从当前位置ios::cur寻址快一点. */</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">inp</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tag</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>                                                       <span class="cm">/* windows中‘\t’和‘\r’重复 if(flag) */</span>
		<span class="p">{</span>
			<span class="n">oup</span> <span class="o">&lt;&lt;</span> <span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="n">last</span><span class="p">;</span>                                             <span class="cm">/* 汉字输出 */</span>
			<span class="n">flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">tmp</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
		<span class="p">{</span>
			<span class="n">last</span>	<span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
			<span class="n">flag</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">oup</span> <span class="o">&lt;&lt;</span> <span class="n">tmp</span><span class="p">;</span>                                                     <span class="cm">/* ASCII表内值输出 */</span>
	<span class="p">}</span>
	<span class="n">inp</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
	<span class="n">oup</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
	<span class="n">finish</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
	<span class="n">system</span><span class="p">(</span> <span class="s">&#34;out.txt&#34;</span> <span class="p">);</span>                                                            <span class="cm">/* 打开输出文件 */</span>
	<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Open the file successfully</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
	<span class="n">oup</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="s">&#34;run_time.txt&#34;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span> <span class="p">);</span>
	<span class="n">oup</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Time: &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; (s)-use beg&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>    <span class="cm">/* 在文件中写入操作时间 */</span>
	<span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><blockquote><p>注：</p><p>代码中使用从文件头开始寻址，比从当前位置ios::cur寻址快一点的原因是由于磁盘的读写方式决定的。因为，所有的寻址搜索都是文件头开始的，cur寻址先从文件头进行寻址到cur位置<br> 再从cur寻址到偏移地址，beg从文件头通过偏移地址得到地址，所以beg要快。</p></blockquote><p>//为了验证这种读写方式，请看我写的一个简单的测试过程：</p><p>为了使影响检测的因素简单化，我把上面代码中一些无关部分删除。</p><p>测试代码：</p><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">clock_t</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">;</span>
	<span class="n">start</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
	<span class="kt">long</span>		<span class="n">len</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">ifstream</span>	<span class="n">inp</span><span class="p">(</span> <span class="s">&#34;in.txt&#34;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">ofstream</span>	<span class="n">oup</span><span class="p">(</span> <span class="s">&#34;out.txt&#34;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="p">);</span>
	<span class="n">inp</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span> <span class="n">len</span><span class="p">,</span> <span class="n">inp</span><span class="p">.</span><span class="n">end</span> <span class="p">);</span>
	<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">inp</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>
	<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A total of &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; bytes</span><span class="se">\n</span><span class="s">Opening file ...&#34;</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span> <span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="cm">/******使用ios::cur寻址的代码********/</span>
		<span class="n">oup</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="n">inp</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
		<span class="n">inp</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span> <span class="o">-</span><span class="mi">2L</span><span class="p">,</span> <span class="n">inp</span><span class="p">.</span><span class="n">cur</span> <span class="p">);</span> <span class="n">len</span><span class="o">--</span><span class="p">;</span>


<span class="cm">/*******使用ios::beg寻址的代码********
</span><span class="cm"> * inp.seekg(len--,inp.beg);
</span><span class="cm"> * oup&lt;&lt;(char)inp.get();
</span><span class="cm"> ************************************/</span>
	<span class="p">}</span>
	<span class="n">inp</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
	<span class="n">oup</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
	<span class="n">finish</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
	<span class="n">FILE</span><span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span> <span class="s">&#34;run_time.txt&#34;</span><span class="p">,</span> <span class="s">&#34;a+&#34;</span> <span class="p">);</span>
	<span class="n">fprintf</span><span class="p">(</span> <span class="n">p1</span><span class="p">,</span> <span class="s">&#34;Time: %.3lf (s)-use cur</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="p">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="p">);</span> <span class="cm">/* 牵扯格式的我比较喜欢用C */</span>
	<span class="n">fclose</span><span class="p">(</span> <span class="n">p1</span> <span class="p">);</span>
	<span class="n">system</span><span class="p">(</span> <span class="s">&#34;run_time.txt&#34;</span> <span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Open the file successfully</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
	<span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>然后，使用一个1000000字节的文本文件测试（测试数据生成代码在最后面），测试结果如下：<br></p><figure class="image-label"><img data-original="https://i.imgur.com/fOGzLOv.jpg" alt="测试结果"><figcaption>测试结果</figcaption></figure><p></p><p>前三个是使用ios::beg寻址的，后三个是使用ios::cur寻址的，很明显前者要快一点。所以印证了我前面所说的。</p><p>附测试数据生成代码：</p><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">freopen</span><span class="p">(</span> <span class="s">&#34;out.txt&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">,</span> <span class="n">stdout</span> <span class="p">);</span>
	<span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span> <span class="n">n</span><span class="o">--</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">putchar</span><span class="p">(</span> <span class="mi">65</span> <span class="o">+</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">26</span> <span class="p">);</span> <span class="cm">/* 大写字母 */</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>测试环境皆为Win XP professional，VC++6.0</p></div></article></div><div class="comment-wrap horizontal-safe" style="padding-left:20px;padding-right:20px"><script src="https://utteranc.es/client.js" repo="qbeenslee/comments.qbeenslee.com" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div></main><footer class="section site_footer_grap unselectable"><div class="has-text-centered"><p>&copy; Qbeenslee 2019</p></div></footer><script type="text/javascript" src="https://qbeenslee.com/js/main.js"></script><script type="text/javascript" src="https://qbeenslee.com/js/load-photoswipe.js"></script><script type="text/javascript" src="https://qbeenslee.com/lib/photoswipe/photoswipe.min.js"></script><script type="text/javascript" src="https://qbeenslee.com/lib/photoswipe/photoswipe-ui-default.min.js"></script><script type="text/javascript">var imgs=$("img");imgs.on("contextmenu",function(){return!1}),imgs.on("dragstart",function(){return!1})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?58b3c65a09f5aacd0e62efe29897c7e4";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>